/*
功能：从version.properties文件中读取版本号,打印出来
*/
version = new ProjectVersion(0,1)
//定义项目版本类
class ProjectVersion{
    Integer major
    Integer minor
    Boolean release
    ProjectVersion(Integer major,Integer minor){
        this.major = major
        this.minor = minor
        this.release = Boolean.FALSE
    }
    ProjectVersion(Integer major,Integer minor,Boolean release){
        this(major,minor)
        this.release = release
    }
    @Override
    String toString(){
        "$major.$minor${release ?'':'-SNAPSHOT'}"
    }
}
//配置代码，读取version.properties文件
ext.versionFile = file('version.properties')
task loadVersion{
    project.version = readVersion()
}
ProjectVersion readVersion(){
    logger.quiet 'Reading the version file.'
    if (!versionFile.exists()){
        throw new GradleException("Required version file does not exist:$versionFile.canonicalPath")
    }
    Properties versionProps = new Properties()
    versionFile.withInputStream{stream->
        versionProps.load(stream)
    }   
    new ProjectVersion(versionProps.major.toInteger(),versionProps.minor.toInteger(),versionProps.release.toBoolean())
}

task printVersion {
    logger.quiet "Version:$version"
}